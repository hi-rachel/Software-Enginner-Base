## 데이터 정규화와 비정규화

**정규화는 데이터 중복을 줄이고 무결성을 보장하기 위해 테이블을 나누는 것**이고,
**비정규화는 조회 성능을 위해 일부러 중복을 허용해 테이블을 합치거나 컬럼을 추가하는 것**입니다.
일반적으로 데이터베이스 설계는 정규화를 기본으로 하고, 성능 문제가 생기면 비정규화를 선택적으로 적용합니다.

반면 [DocumentDB](DocumentDB.md) 같은 NoSQL은 스키마 제약이 약하고 JOIN을 지양하기 때문에, 전통적인 정규화보다는 조회 성능을 위한 비정규화 설계를 더 많이 활용합니다.
즉, RDB는 정규화를 기본으로 설계 후 필요 시 비정규화를 적용하고, NoSQL은 비정규화가 자연스러운 기본 설계 방식입니다.

## 데이터 정규화 (Normalization)

목표: 데이터 중복을 줄이고 일관성을 높이기 위해 테이블을 쪼개고 관계를 명확히 하는 과정.

특징

- 중복 최소화, 데이터 무결성 유지.
- 이상현상(삽입, 갱신, 삭제 이상) 방지.
- 테이블 수가 늘어나고, 조회 시 JOIN 연산이 많아져 성능이 느려질 수 있음.

장점

- 데이터 일관성 ↑
- 저장 공간 절약
- 데이터 변경 용이

---

## 데이터 비정규화 (Denormalization)

목표: 성능 최적화를 위해 정규화된 데이터를 다시 합치거나 중복을 허용하는 과정.

특징

- 데이터 중복 허용 → 조회 시 JOIN 최소화.
- 응답 속도 개선.
- 데이터 일관성 관리가 어려워짐.

장점

- 조회 성능 ↑ (특히 읽기 많은 시스템에서)
- 복잡한 JOIN 감소
- 캐싱 효과

---

### 이상 현상 (Anomalies)

정규화를 하지 않거나, 설계가 잘못된 테이블 구조에서 발생하는 데이터 불일치 문제를 말합니다.

1. 삽입 이상 (Insertion Anomaly)

   - 새로운 데이터를 추가하려 할 때, 불필요하거나 아직 모르는 값까지 넣어야 하는 문제.
   - 예: 학생–수강 테이블에서 학생만 추가하려 해도 수강 과목 정보가 없으면 삽입 불가.

2. 갱신 이상 (Update Anomaly)

   - 같은 데이터가 여러 군데 중복되어 저장되어 있을 때, 일부만 수정되어 불일치 발생.
   - 예: 부서명이 여러 직원 레코드에 중복 저장되어 있는데, 한 곳만 변경 → 다른 곳은 그대로.

3. 삭제 이상 (Deletion Anomaly)
   - 특정 데이터만 지우려다, 원치 않는 데이터까지 사라지는 문제.
   - 예: 어떤 과목을 수강하던 마지막 학생을 삭제하면, 그 과목 자체의 정보도 함께 손실.

---

정합성은 데이터가 현실 규칙과 맞게 유지되는 것을 의미하고, 무결성은 이를 보장하기 위한 제약 조건입니다. 트랜잭션은 ACID 성질을 통해 일관성과 정합성을 보장하며, 동시성 제어와 적절한 고립 수준을 설정해 여러 사용자가 동시에 접근해도 데이터가 깨지지 않게 합니다.

💡 정합성 (Consistency)

'데이터 값이 현실 세계 규칙과 맞아떨어진다' 에 초점.

- 의미: **데이터가 비즈니스 규칙이나 제약 조건에 맞게 논리적으로 일관된 상태를 유지하는 것**.
- 예: 재고가 -1이 되면 안 된다, 학생 나이가 음수일 수 없다.

💡 무결성 (Integrity)

- 의미: **데이터의 정확성, 일관성, 유효성을 보장하는 성질**.
- 종류:
  - **개체 무결성: 기본키는 중복/NULL 불가**.
  - **참조 무결성: 외래키는 참조하는 테이블의 기본키와 일치하거나 NULL이어야 함**.
  - **도메인 무결성: 정의된 타입, 범위만 값으로 허용**.

💡 트랜잭션 (Transaction)

- 의미: **데이터베이스에서 하나의 논리적 작업 단위**.
- ACID 특성 보장:
  - **원자성(Atomicity): 모두 실행되거나 전혀 실행되지 않음**.
  - **일관성(Consistency): 제약조건, 규칙 만족**.
  - **격리성(Isolation): 동시에 실행되는 트랜잭션 간 간섭 최소화**.
  - **지속성(Durability): 커밋된 결과는 영구 반영**.

💡 일관성 (Consistency in ACID)

- 의미: 트랜잭션 전후에 DB가 유효한 상태 → 또 다른 유효한 상태로 바뀌어야 한다는 성질.
- 예: 송금 트랜잭션에서 A 계좌 감소 + B 계좌 증가가 동시에 완료되어야 “합계 금액이 불변”이라는 제약을 만족.

---

> 추가 공부 필요

💡 동시성 제어 (Concurrency Control)

- 의미: 여러 사용자가 동시에 DB에 접근할 때 정합성과 무결성이 깨지지 않도록 제어.
- 기법: 잠금(Lock), MVCC, 직렬화 스케줄링 등.

💡 고립 수준 (Isolation Level)

- 트랜잭션 간 격리 정도. 낮을수록 동시성↑, 이상현상 발생 가능성↑.
- ANSI SQL 표준:
  - Read Uncommitted: 커밋 안 된 데이터 읽음 → Dirty Read 발생.
  - Read Committed: 커밋된 데이터만 읽음 → Non-Repeatable Read 가능.
  - Repeatable Read: 같은 쿼리 결과는 일관되게 읽음 → Phantom Read 가능.
  - Serializable: 완벽한 직렬화, 동시성↓.
